<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<script>
let mensaje =("Por seleccione el tipo de numero que desea ingresar" + '</br>' + "Escriba 1 para numero romano" + "</br>"
+ "Escriba 2 para numero arabe" + "</br>");
let tipoNumero=prompt(mensaje);
let numero=prompt("Ingrese el numero");
const valoresRomanos={I : 1,V : 5,X : 10,L: 50,C : 100,D : 500,M : 1000};
let numeroArabe=0;    
let numeroRomano='';
let arreglo= new Array;
let mensajeValidacion='ok';
let longitud=0;


function convertirArabes(numRomano){
 
    arreglo=numRomano.split('');

    for(let char in arreglo){
       let indicePosterior= parseInt(char) +1;
       longitud=arreglo.length;
          
        if (indicePosterior < longitud){
         
            if( valoresRomanos[arreglo[char]] < valoresRomanos[arreglo[indicePosterior]] ){
                numeroArabe+=(valoresRomanos[arreglo[char]]*(-1));
                 }
            else {
                numeroArabe+=valoresRomanos[arreglo[char]];
            }
        } else {
            numeroArabe+=valoresRomanos[arreglo[char]];
        }

    }
    return (numeroArabe); 
}

function validarRomanos(numRomano){

   longitud=arreglo.length;
    for(let char in arreglo){
  
        let indicePosterior2= parseInt(char) +1;
        let validarI=new Array();
        let validarX=new Array();
        let validarC=new Array();
        validarI=['V','X','I'];
        validarX=['L','C','X'];
        validarC=['D','M','C'];

        if (indicePosterior2 < longitud){
  //Valido I
            if(arreglo[char]==='I'&& (!((validarI.indexOf(arreglo[indicePosterior2]))>=0))){
                mensajeValidacion='I solo puede preceder a V o X, el numero romano proporcionado no es valido'
            return mensajeValidacion;
            }
  //Valido X            
            if(arreglo[char]==='X'&& (!((validarX.indexOf(arreglo[indicePosterior2]))>=0))){
                mensajeValidacion='X solo puede preceder a L o C, el numero romano proporcionado no es valido'
            return mensajeValidacion;
            }
  //Valido C            
  if(arreglo[char]==='C'&& (!((validarC.indexOf(arreglo[indicePosterior2]))>=0))){
            mensajeValidacion='C solo puede preceder a D o M, el numero romano proporcionado no es valido'
            return mensajeValidacion;
            }
        }   
        
    }
//Reviso que I,X,C,M no se repitan mas de tres veces
let charMap={};
let lon=arreglo.length;
    for (let i=0; i<lon;i++){  
            if (charMap.hasOwnProperty(arreglo[i])){
                charMap[arreglo[i]]++;
            }
            else {
                charMap[arreglo[i]]=1;
            }
        
        }
    for (let char in charMap){
 
            if (charMap[char]>3){
                mensajeValidacion='Numero romano no valido, No se puede repetir '+ char +' mas de tres veces'
                return mensajeValidacion;
                break;
            }   
 //Reviso que V,Ly D no se repitan mas de tres veces
            if((char==='V'||char==='L'||char==='D')&& charMap[char]>1){
                mensajeValidacion='Numero romano no valido, No se puede repetir '+ char +' mas de una vez'
                return mensajeValidacion;
                break;
            }

    }     
 
}

function convertirRomanos(numero){
   if (isNaN(numero) || parseInt(numero)>3999 || parseInt(numero)<1 ){
       mensajeValidacion='numero no valido';
       alert('no acepta el numero ')//) + (!isNaN(numero))
       return mensajeValidacion;

   }
   else {
 //Agrego los miles

        let miles=Math.trunc((parseInt(numero)/1000));
        let residuo=(parseInt(numero)%1000);
        //alert (miles);
        for (let i=1;i<=miles;i++){
            numeroRomano+='M';
        }
  //Agrego los centenares
  let centenares=Math.trunc((parseInt(residuo)/100));
  residuo=(parseInt(residuo)%100);
    //alert('centenares ' + centenares);
            if (centenares===9){
             numeroRomano+='CM';

            }
            else if (centenares>=5){
                numeroRomano+='D';
                for (let j=0;j<(centenares-5);j++){
                    numeroRomano+='C';
                }
            }
            else if (centenares===4){
                numeroRomano+='CD';

            }
            else if (centenares<=3){
                for (let j=0;j<centenares;j++){
                numeroRomano+='C';
                }
            }
//Agrego decenas
let decenas=Math.trunc((parseInt(residuo)/10));
  residuo=(parseInt(residuo)%10);
    
            if (decenas===9){
             numeroRomano+='XC';

            }
            else if (decenas>=5){
                numeroRomano+='L';
                for (let k=0;k<(decenas-5);k++){
                    numeroRomano+='X';
                }
            }
            else if (decenas===4){
                numeroRomano+='XL';

            }
            else if (decenas<=3){
                for (let k=0;k<decenas;k++){
                    numeroRomano+='X';
                }
            }

//Agrego unidades
let unidades=Math.trunc((parseInt(residuo)/1));
  residuo=(parseInt(residuo)%1);
    
            if (unidades===9){
             numeroRomano+='IX';

            }
            else if (unidades>=5){
                numeroRomano+='V';
                for (let l=0;l<(unidades-5);l++){
                    numeroRomano+='I';
                }
            }
            else if (unidades===4){
                numeroRomano+='IV';

            }
            else if (unidades<=3){
                for (let l=0;l<unidades;l++){
                    numeroRomano+='I';
                }
            }

   }
    return numeroRomano
}

    if (tipoNumero=='1') {
        if  (validarRomanos(numero)!=='ok'){
            alert(mensajeValidacion);
        
        }
        else{
           alert(  convertirArabes(numero));
        }
      //  alert ('tipo numero 1 ' + tipoNumero);
    }
    else if (tipoNumero='2'){
    alert(   convertirRomanos(numero));
       //alert ('tipo numero 2 ' + tipoNumero);
    }



  
    </script>
</body>
</html>