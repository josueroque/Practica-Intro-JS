<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<script>
let mensaje =("Por seleccione el tipo de numero que desea ingresar" + '</br>' + "Escriba 1 para numero romano" + "</br>"
+ "Escriba 2 para numero arabe" + "</br>");
let tipoNumero=prompt(mensaje);
let numero=prompt("Ingrese el numero");
const valoresRomanos={I : 1,V : 5,X : 10,L: 50,C : 100,D : 500,M : 1000};
let numeroArabe=0;    
let arreglo= new Array;
let mensajeValidacion="ok";
let longitud=0;

function convertirArabes(numRomano){
 
    arreglo=numRomano.split('');
    if  (validarRomanos(numRomano)!=='ok'){
      //  alert(mensajeValidacion);
     //   return;
    } ;
    for(let char in arreglo){
       let indicePosterior= parseInt(char) +1;
       longitud=arreglo.length;
          
        if (indicePosterior < longitud){
         
            if( valoresRomanos[arreglo[char]] < valoresRomanos[arreglo[indicePosterior]] ){
                numeroArabe+=(valoresRomanos[arreglo[char]]*(-1));
                 }
            else {
                numeroArabe+=valoresRomanos[arreglo[char]];
            }
        } else {
            numeroArabe+=valoresRomanos[arreglo[char]];
        }

    }
    return (numeroArabe); 
}


function validarRomanos(numRomano){

   longitud=arreglo.length;
    for(let char in arreglo){
  
        let indicePosterior2= parseInt(char) +1;
        let validarI=new Array();
        let validarX=new Array();
        let validarC=new Array();
        validarI=['V','X'];
        validarX=['L','C'];
        validarC=['D','M'];

        if (indicePosterior2 < longitud){
  //Valido I
            if(arreglo[char]==='I'&& (!((validarI.indexOf(arreglo[indicePosterior2]))>=0))){
                mensajeValidacion='I solo puede preceder a V o X, el numero romano proporcionado no es valido'
            return mensajeValidacion;
            }
  //Valido X            
            if(arreglo[char]==='X'&& (!((validarX.indexOf(arreglo[indicePosterior2]))>=0))){
                mensajeValidacion='X solo puede preceder a L o C, el numero romano proporcionado no es valido'
            return mensajeValidacion;
            }
  //Valido C            
  if(arreglo[char]==='C'&& (!((validarC.indexOf(arreglo[indicePosterior2]))>=0))){
                mensajeValidacion='C solo puede preceder a D o M, el numero romano proporcionado no es valido'
            return mensajeValidacion;
            }
        }   
        
    }
//Reviso que I,X,C,M no se repitan mas de tres veces
let charMap={};
let lon=arreglo.length;
    for (let i=0; i<lon;i++){  
            if (charMap.hasOwnProperty(arreglo[i])){
                charMap[arreglo[i]]++;
            }
            else {
                charMap[arreglo[i]]=1;
            }
        
        }
    for (let char in charMap){
        alert('La clave es' + charMap[char]);
            if (charMap[char]>3){
                mensajeValidacion='Numero romano no valido, No se puede repetir ${char}  mas de tres veces'
                return mensajeValidacion;
                break;
            }   
 //Reviso que V,Ly D no se repitan mas de tres veces
            if((char==='V'||char==='L'||char==='D')&& charMap[char]>1){
                mensajeValidacion='Numero romano no valido, No se puede repetir ${char}  mas de una vez'
                return mensajeValidacion;
                break;
            }

    }     
 
}

function convertirRomanos(numero){
   if (!isNaN(numero)){
       mensajeValidacion='numero no valido';
       return mensajeValidacion;
   }
   else {

   }
    
}

    if (tipoNumero='1') {
        convertirArabes(numero);
     //alert(  convertirArabes(numero));
    }
        else if (tipoNumero='2'){
       convertirRomanos(numero);
    }



  
    </script>
</body>
</html>